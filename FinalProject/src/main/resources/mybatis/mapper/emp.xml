<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.app.emp.model.EmpDAO">

	<!-- 컬럼명 == DTO 프로퍼티명(소문자)로 매핑 -->
	<resultMap id="EmpMap" type="com.spring.app.emp.domain.EmpDTO">
		<id     property="emp_no"               column="EMP_NO"/>
		<result property="emp_pwd"              column="EMP_PWD"/>
		<result property="emp_name"             column="EMP_NAME"/>
		<result property="fk_rank_no"           column="FK_RANK_NO"/>
		<result property="rank_name"			column="RANK_NAME"/>
		<result property="fk_dept_no"           column="FK_DEPT_NO"/>
		<result property="team_name"			column="TEAM_NAME"/>
		<result property="dept_name"			column="DEPT_NAME"/>
		<result property="ex_email"             column="EX_EMAIL"/>
		<result property="emp_email"            column="EMP_EMAIL"/>
		<result property="phone_num"            column="PHONE_NUM"/>
		<result property="rr_number"			column="RR_NUMBER"/>
		<result property="emp_account"          column="EMP_ACCOUNT"/>
		<result property="emp_bank"             column="EMP_BANK"/>
		<result property="hiredate"             column="HIREDATE"/>
		<result property="resigndate"           column="RESIGNDATE"/>
		<result property="emp_status"           column="EMP_STATUS"/>
		<result property="emp_origin_filename"  column="EMP_ORIGIN_FILENAME"/>
		<result property="emp_save_filename"    column="EMP_SAVE_FILENAME"/>
		<result property="emp_filesize"         column="EMP_FILESIZE"/>
		<result property="postcode"				column="POSTCODE"/>
		<result property="address"				column="ADDRESS"/>
		<result property="detail_address"		column="DETAIL_ADDRESS"/>
		<result property="extra_address"		column="EXTRA_ADDRESS"/>
		
		<!-- position을 Map List 로 매핑 -->
		<collection property="position" ofType="java.util.HashMap">
			<id property="position_no"		column="position_no"/>
			<id property="position_name"	column="position_name"/>
		</collection>
	</resultMap>

	<!-- 로그인용 단건 조회
		 DATE/NUMBER를 String으로 받으므로 TO_CHAR로 포맷 통일(원하면 유지 가능) -->
	<select id="selectEmpByEmpNo" parameterType="string" resultMap="EmpMap">
		SELECT
			EMP_NO,
			EMP_PWD,
			EMP_NAME,
			FK_RANK_NO,
			FK_DEPT_NO,
			EX_EMAIL,
			EMP_EMAIL,
			PHONE_NUM,
			RR_NUMBER,
			EMP_ACCOUNT,
			EMP_BANK,
			TO_CHAR(HIREDATE, 'YYYY-MM-DD') AS HIREDATE,
			TO_CHAR(RESIGNDATE, 'YYYY-MM-DD') AS RESIGNDATE,
			EMP_STATUS,
			EMP_ORIGIN_FILENAME,
			EMP_SAVE_FILENAME,
			TO_CHAR(NVL(EMP_FILESIZE,0)) AS EMP_FILESIZE
			FROM TBL_EMPLOYEE
			WHERE EMP_NO = #{empNo}
	</select>
  
	<select id="selectEmpInfoByEmpNo" parameterType="string" resultMap="EmpMap">
		select		e.emp_no,		e.emp_pwd,	e.emp_name,
					e.fk_rank_no,	r.rank_name,
					e.fk_dept_no,	d.dept_name as team_name,	d_p.dept_name as dept_name,
					e.ex_email,	e.emp_email,	e.phone_num,
					e.rr_number,
					e.emp_account,	e.emp_bank,
					to_char(e.hiredate,		'yyyy-mm-dd') as hiredate,
					to_char(e.resigndate,	'yyyy-mm-dd') as resigndate,
					e.emp_status,			e.emp_origin_filename,
					e.emp_save_filename,	to_char(e.emp_filesize),
					p.position_no,			p.position_name,
					e.postcode,			e.address,
					e.detail_address,	e.extra_address
		from		tbl_employee e
		left join	tbl_employee_position ep
		on			e.emp_no = ep.fk_emp_no
		left join	tbl_position p
		on			ep.fk_position_no = p.position_no
		left join	tbl_department d
		on			e.fk_dept_no = d.dept_no
		left join	tbl_department d_p
		on			d.parent_dept_no = d_p.dept_no
		left join	tbl_rank r
		on			e.fk_rank_no = r.rank_no
		where		e.emp_no = #{emp_no}
	</select>

</mapper>
